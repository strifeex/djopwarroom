BEGIN MERGE
INTO    WARROOM_JVN_GROUPYEAR_ALL d
USING   (
        	SELECT RECEIVE_YEAR, N, Y, K, N+Y+K AS TOTAL, SYSTIMESTAMP FROM(
				SELECT * FROM 
					(SELECT DISTINCT JVN_ID, RECEIVE_YEAR, NVL2(CTRL_STATUS,CTRL_STATUS,0) AS stat  FROM VDTL_CMST_CASE_MAIN_HD2 WHERE RECEIVE_YEAR = to_char(sysdate, 'YYYY')+543 ) 
					PIVOT(
					    COUNT(JVN_ID) 
					    FOR stat
					    IN ( 
					        'N' N,
					        'Y' Y,
					        'K' K
					    )
					)
			)
        ) s
ON      (s.RECEIVE_YEAR = d.YEAR)
WHEN NOT MATCHED THEN
INSERT  (YEAR, ENSURE, CONTROL, NOCONTROL, TOTAL, UPDATE_TIME) 
VALUES  (RECEIVE_YEAR, N, Y, K,  N+Y+K, SYSTIMESTAMP)
WHEN MATCHED THEN
UPDATE
SET     ENSURE = N, 
        CONTROL = Y, 
        NOCONTROL = K, 
        TOTAL = TOTAL, 
        UPDATE_TIME = SYSTIMESTAMP; END;